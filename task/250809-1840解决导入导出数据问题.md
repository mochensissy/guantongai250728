# 250809-1840 解决导入导出数据问题

## 1. 问题现象
- 在“导出数据 → 删除文档 → 再导入”流程中，导入完成后页面没有任何变化，需要手动刷新或重新进入才看到数据。

## 2. 根因分析
- 导入完成虽然写入了本地存储，但页面没有感知导入事件；并且此前为防止“批量删除回流”引入了墓碑（deleted-ids），如果不清理墓碑，刚导入的数据会继续被过滤掉，看起来像“导入无反应”。

## 3. 解决方案
- 导入成功后触发 UI 自动刷新与墓碑清理：
  1) `src/components/DataLifecycleManager.tsx`
     - 导入成功后：
       - 清空墓碑 `ai-learning-platform-deleted-ids`，确保导入可见；
       - 派发全局事件 `storageImported`，通知仪表板和其他依赖组件即时刷新；
       - 继续显示“导入成功（覆盖/合并）”提示。
  2) `pages/dashboard.tsx`
     - 监听 `storageImported` 事件，收到后重新加载会话列表，无需手动刷新浏览器。
  3) `src/utils/storage.ts`
     - `importData()` 仅负责把数据写入本地；安全策略保持不变：**永远保留本地已配置 API**，备份导入不会覆盖密钥，导出也可不包含 API 信息，避免泄露。

## 4. 影响范围
- `src/components/DataLifecycleManager.tsx`（导入后清墓碑+派发事件）
- `src/utils/storage.ts`（导入保留本地 API）
- `pages/dashboard.tsx`（监听事件即时刷新）

## 5. 验证步骤
1) 仪表板导出数据；
2) 批量删除记录；
3) 选择“导入备份”（覆盖或合并均可）；
4) 导入成功弹窗出现后，仪表板列表即时刷新；
5) 导入的数据可见，不需手动刷新；API 配置仍沿用本机已配置的密钥。

## 6. 备注与可选策略
- 当前策略为“导入成功清墓碑”以确保导入可见；如果希望“导入也保持已删除状态不恢复”，可切换为合并导入不清墓碑，仅覆盖导入时清墓碑。

