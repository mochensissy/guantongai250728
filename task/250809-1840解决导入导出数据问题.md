# 250809-1840 解决导入导出数据问题

## 背景
导出备份 → 删除本地记录 → 再导入 时，出现“导入无响应/必须刷新页面才能看到数据”的体验问题；另需确保导入后继续沿用本机 API 配置，避免备份泄露密钥。

## 目标
- 导入成功后无需手动刷新即可看到数据
- 保持本机已配置的 API，不被备份覆盖；备份文件也无需包含 API 密钥

## 方案设计与实现

### 1) 导入后的即时刷新
- 修改 `src/components/DataLifecycleManager.tsx`：
  - 导入成功后，统一执行：
    - 清空墓碑 `ai-learning-platform-deleted-ids`（允许导入的数据恢复显示）
    - `window.dispatchEvent(new CustomEvent('storageImported'))`
  - 仪表板 `pages/dashboard.tsx` 已监听 `storageImported`，收到后：
    - 调用 `purgeTombstonedSessions()` 做一次本地物理清理
    - `getAllSessions()` 并 `setSessions()`，页面立即刷新

### 2) API 配置安全与沿用
- 修改 `src/utils/storage.ts` 的 `importData()`：
  - 读取当前本机数据 `current = safeGetStorageData()`
  - 合并后强制保留本机 API：`finalData.apiConfig = current.apiConfig || finalData.apiConfig`
  - 返回导入结果，UI 层负责后续刷新

### 3) 模式一致性
- 覆盖导入与合并导入共用同一套“清墓碑 + 事件刷新”的流程，保证行为一致、反馈清晰

## 用户可见变化
- 导入成功会弹窗提示，并且列表立即刷新，无需手动刷新页面
- 导入的备份不会覆盖你的 API 配置，也无需将 API 放进备份中

## 影响范围
- `src/components/DataLifecycleManager.tsx`
- `src/utils/storage.ts`
- （已存在）`pages/dashboard.tsx` 监听刷新逻辑，无需变动

## 回滚策略
- 如需改为“合并导入也保留已删状态（不恢复墓碑项）”，可以在导入成功后不清空 `ai-learning-platform-deleted-ids`，仅派发 `storageImported` 即可。

