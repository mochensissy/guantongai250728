# 250808-1700 解决批量删除和导入导出功能问题

## 背景
- 仪表盘“学习历史”需要支持一次性删除多条记录，避免逐条确认的低效交互。
- 数据管理仅有“导出备份”，缺少“导入备份”；且导入后需要刷新才能看到；部分用户导入后提示需要重新配置 API。

## 目标
- 支持多选/全选的批量删除，一次确认后批量执行。
- 新增“导入备份”，提供覆盖/合并两种模式；导入成功后无需刷新即可看到变化；覆盖导入时保留本地 API 配置。

## 实现方案
### 1) 批量删除
- 在 `src/components/SessionHistoryList.tsx`：
  - 新增选择状态：`selectedIds`、`allSelected`；提供 `toggleSelectAll`、`toggleSelectOne`；
  - 顶部工具栏加入“全选”和“批量删除(N)”按钮；每行左侧增加复选框；
  - 新增 `onBatchDelete?: (ids: string[]) => void` 回调：
    - 若传入该回调，则交由上层统一确认一次并批量删除；
    - 否则回退到组件内的逐条确认逻辑。
- 在 `pages/dashboard.tsx`：
  - 实现 `handleBatchDelete(ids)`：一次 `confirm` 后循环调用 `deleteSession(id)`，统一更新 `sessions` 状态；
  - 将 `onBatchDelete` 传给 `SessionHistoryList`。

### 2) 导入备份
- 入口：`src/components/DataLifecycleManager.tsx`，在“导出备份”旁新增“导入备份”按钮。
- 覆盖/合并：
  - 覆盖导入：直接写入备份，但若备份缺少 `apiConfig`，自动保留本地现有 `apiConfig`；
  - 合并导入：会话按 id 去重，保留 `updatedAt` 更新更近的一份；`preferences` 字段合并；`apiConfig` 以本地优先；
- 即时刷新：导入成功后触发 `window.dispatchEvent(new CustomEvent('localDataImported'))`；
  - `pages/dashboard.tsx` 监听该事件，收到后重新读取本地 `sessions` 并刷新界面；无需手动刷新。

### 3) 关键代码文件
- `src/components/SessionHistoryList.tsx`
- `pages/dashboard.tsx`
- `src/components/DataLifecycleManager.tsx`

## 边界与校验
- 导入文件类型校验：仅允许 `application/json`；解析失败给出提示。
- 基础数据校验：`sessions` 必须为数组；版本不一致时走本地迁移逻辑（由 `utils/storage.ts` 负责）。
- 安全提示：批量删除和覆盖导入均有二次确认。

## 用户体验改进
- 批量删除只确认一次，显著减少重复确认。
- 导入后即时生效；覆盖模式不再丢失 API 配置，避免导入后“需要重新配置 API”的困扰。

## 回滚与影响
- 仅新增 UI 控件与事件监听，不影响既有数据结构；
- 任一问题可通过移除 `onBatchDelete` 回调退回到逐条确认删除；移除“导入备份”按钮则恢复到仅导出模式。

